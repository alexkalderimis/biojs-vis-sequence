!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;"undefined"!=typeof window?t=window:"undefined"!=typeof global?t=global:"undefined"!=typeof self&&(t=self),t.oo=e()}}(function(){var e;return function t(e,n,o){function i(r,a){if(!n[r]){if(!e[r]){var c="function"==typeof require&&require;if(!a&&c)return c(r,!0);if(s)return s(r,!0);var l=new Error("Cannot find module '"+r+"'");throw l.code="MODULE_NOT_FOUND",l}var h=n[r]={exports:{}};e[r][0].call(h.exports,function(t){var n=e[r][1][t];return i(n?n:t)},h,h.exports,t,e,n,o)}return n[r].exports}for(var s="function"==typeof require&&require,r=0;r<o.length;r++)i(o[r]);return i}({1:[function(e,t){function n(){var e=this,t=jQuery('<select> <option value="FASTA">FASTA</option><option value="CODATA">CODATA</option><option value="PRIDE">PRIDE</option><option value="RAW">RAW</option></select>');return t.val(e.options.get("format")),t.change(function(){e.setFormat(jQuery(this).val())}),this.options.on("change:format",function(e){t.val(e)}),t}function o(){var e=this,t=jQuery('<select><option value="10">10</option><option value="35">35</option><option value="70">70</option><option value="100">100</option></select>');return t.val(String(this.options.get("numCols"))),t.change(function(){e.options.set({numCols:parseInt(jQuery(this).val(),10)})}),this.options.on("change:numCols",function(e){t.val(String(e))}),t}function i(){var e,t=this;return e=jQuery('<input type="checkbox">'),e.prop("checked",!!this.options.get("colouredBases")),e.change(function(){t.options.set({colouredBases:e.prop("checked")})}),t.options.on("change:colouredBases",function(t){e.prop("checked",t)}),e}function s(e,t,n){var o=jQuery("<div>").addClass(e.get("controlClass")),i=jQuery("<label>").addClass(e.get("labelClass")).text(e.get(t));return e.on("change:"+t,function(e){i.text(e)}),n.addClass(e.get("inputClass")),n.is('[type="checkbox"]')?jQuery('<div class="checkbox">').append(i.prepend(n)):(o.append(i),o.append(n),o)}function r(){var e=h[this.options.get("format")];if(!e)throw new Error("Don't know how to render "+fmt);return new e({width:parseInt(this.options.get("numCols"),10),addBaseClass:!!this.options.get("colouredBases"),onMouseEnter:this._recordEntry.bind(this),onChangeSelection:this.options.on.bind(this.options,"change:selection")})}var a="selection-change",c="selection-changed",l="annotation-clicked",h=e("./renderers"),u=e("./model"),p=e("biojs-events"),d=e("./style"),f={format:"FASTA",selection:{start:0,end:0},colouredBases:!1,numCols:35,highlights:[],annotations:[],sequenceUrl:"http://www.ebi.ac.uk/das-srv/uniprot/das/uniprot/sequence",formatSelectorVisible:!0,loadStyle:!0,labelFormat:"Format",labelNumCols:"Columns",labelColouredBases:"Colour Bases",controlsClass:"form-inline",controlClass:"form-group",inputClass:"form-control",labelClass:"form-label"};Sequence=function(e){this._container=jQuery(e.target),0===this._container.length&&(this._container=jQuery("#"+e.target)),this.options=new u(e,f),this._initialize()},p.mixin(Sequence.prototype),Sequence.prototype.eventTypes=[c,a,l],Sequence.prototype.getId=function(){return this.opt.id};var g={position:"absolute","z-index":"999999",color:"#fff","font-size":"12px",width:"auto",display:"none"};Sequence.prototype._initialize=function(){var e=this;this._appendStyle(),["width","height"].forEach(function(t){var n=e.options.get(t);n>0&&e._container[t](n)}),this._container.toggleClass("no-user-selection",!this.options.get("allowSelection")),this._buildFormatSelector(),this._contentDiv=jQuery("<div>").addClass("sequence-content").appendTo(this._container),this._tooltip=jQuery("<div>").css(g).addClass("tooltip").appendTo("body").hide(),this._bindEvents(),this._run()},Sequence.prototype._run=function(){this.options.has("sequence")?this.options.trigger("change:format"):this.options.has("id")?this._requestSequence(this.getId()):this.clearSequence("No sequence available","../biojs/css/images/warning_icon.png")},Sequence.prototype._bindEvents=function(){var e=this,t=function(){e._redraw()},n=function(){e.options.set({renderer:r.call(e)})};this.options.on("change:format",n),this.options.on("change:colouredBases",n),this.options.on("change:numCols",n),this.options.on("change:sequence",function(){e.options.set({highlights:[],annotations:[]},{silent:!0}),e.setSelection(0,0)}),this.options.on("change:highlights",t),this.options.on("change:annotations",t),this.options.on("change:id",t),this.options.on("change:renderer",t),this.options.on("change:sequence",t),this.options.on("change:selection",function(t){e.trigger(c,t)}),this.options.on("change:allowSelection",function(t){e._container.toggleClass("no-user-selection",!t)}),this._contentDiv.on("mousedown",function(){e.startSelecting()}),this._contentDiv.on("mouseup",function(){e.stopSelecting()}),this._contentDiv.on("mouseleave",function(){e.stopSelecting()})};var y="../biojs/css/images/warning_icon.png";Sequence.prototype._requestSequence=function(e){var t=this;jQuery.ajax({url:this.options.get("sequenceUrl"),dataType:"xml",data:{segment:e},success:function(){try{var e=jQuery(xml).find("SEQUENCE:first");t.setSequence(e.text(),e.attr("id"),e.attr("label"))}catch(n){console.log("Error decoding response data: "+n.message),t.clearSequence("No sequence available",y)}},error:function(e,n){console.log("Error decoding response data: "+n),t.clearSequence("Error requesting the sequence to the server "+this.url,y)}})},Sequence.prototype.setSequence=function(e,t){1===arguments.length?this._requestSequence(arguments[0]):this.options.set({sequence:e,id:t})},Sequence.prototype.clearSequence=function(e,t){var n;this.setSequence("",""),e?(n=jQuery("<div>").text(e).addClass("message"),t&&n.css({background:'transparent url("'+t+'") no-repeat center left',"padding-left":"20px"}),this._contentDiv.html(n)):this._contentDiv.empty()},Sequence.prototype.setSelection=function(e,t){if(e>t){var n=t;t=e,e=n}this.options.set({selection:{start:e,end:t}})};var v=[".seq-base.adenine {background: #656cca; color: white;}",".seq-base.cytosine {background: #ffd76b; color: #8A6F25;}",".seq-base.guanine {background: #50c0ad; color: white;}",".seq-base.thymine {background: #ffa76b; color: #A76C45;}",".seq-base.info, .interbase.info {background: #4090f7; color: white;}",'.sequence-content {font-family: "Andale mono", courier, monospace; font-size: 12px; text-align: left;}','.sequence-controls {font-family: "Helvetica Neue", Arial, "sans serif"; font-size: 14px}',".no-user-selection {-moz-user-select: none; -webkit-user-select: none; user-select: none;}",".seq-base.selection, .interbase.selection {background: yellow; color: black;}"];Sequence.prototype._appendStyle=function(){var e;this.options.get("loadStyle")&&(e=v.join("\n"),d(e,document))},Sequence.prototype.setFormat=function(e){if(!e)throw new Error("argument is required: format");this.options.set({format:String(e).toUpperCase()})},Sequence.prototype._buildFormatSelector=function(){var e,t=this,r=this.options;this._headerDiv=e=jQuery("<form>").addClass("sequence-controls").addClass(this.options.get("controlsClass")).appendTo(this._container),e.append(s(r,"labelFormat",this._formatSelector=n.call(this))),e.append(s(r,"labelNumCols",this._columnWidthSelector=o.call(this))),e.append(s(r,"labelColouredBases",i.call(this))),this.options.on("change:formatSelectorVisible",function(){t._headerDiv.toggle(t.options.get("formatSelectorVisible"))}),t._headerDiv.toggle(t.options.get("formatSelectorVisible"))},Sequence.prototype.highlight=function(e,t,n,o){return this.addHighlight({start:e,end:t,kind:n,id:o})},Sequence.prototype._highlightsCount=0,Sequence.prototype.addHighlight=function(e){var t,n,o,i=this.options.get("highlights");return!e||e.start>e.end?null:(n=e.kind||"info",t="string"==typeof e.id?e.id:String(this._highlightsCount++),o={start:e.start,end:e.end,kind:n,id:t},i=i.concat([o]),this.options.set({highlights:i}),o.id)},Sequence.prototype.unHighlight=function(e){this.removeHighlight(e)},Sequence.prototype.removeHighlight=function(e){this.options.set({highlights:this.options.get("highlights").filter(function(t){return t.id!==e})})},Sequence.prototype.unHighlightAll=function(){this.removeAllHighlights()},Sequence.prototype.removeAllHighlights=function(){this.options.set({highlights:[]})},Sequence.prototype.setNumCols=function(e){this.options.set({numCols:e})},Sequence.prototype.formatSelectorVisible=function(e){return 0===arguments.length?this.options.get("formatSelectorVisible"):void this.options.set({formatSelectorVisible:e})},Sequence.prototype.showFormatSelector=function(){this.formatSelectorVisible(!0)},Sequence.prototype.hideFormatSelector=function(){this.formatSelectorVisible(!1)},Sequence.prototype.hide=function(){this._headerDiv.hide(),this._contentDiv.hide()},Sequence.prototype.show=function(){this._headerDiv.show(),this._contentDiv.show()},Sequence.prototype._isSelecting=!1,Sequence.prototype._lastEntered=-1,Sequence.prototype._selectionStart=-1,Sequence.prototype.startSelecting=function(){this._isSelecting=!0,this._selectionStart=this._lastEntered,this.setSelection(this._lastEntered,this._lastEntered)},Sequence.prototype.stopSelecting=function(){this._isSelecting=!1,this._lastEntered=-1,this._selectionStart=-1},Sequence.prototype._recordEntry=function(e){if(this._lastEntered=e,this._isSelecting){{this.options.get("selection")}this.setSelection(this._selectionStart,e)}},Sequence.prototype._redraw=function(){var e=this.options.get("renderer");e&&this._contentDiv.html(e.render(this.options.get("sequence"),this.options.get("id"),this.getHighlights(),this.options.get("annotations")))},Sequence.prototype.getHighlights=function(){var e=this.options.get("highlights").slice(),t=this.options.get("selection");return t&&e.push({start:t.start,end:t.end,kind:"selection",id:"__selection__"}),e},Sequence.prototype._addToolTip=function(e,t){var n="#sequenceTip"+this.getId();jQuery(e).mouseover(function(o){var i=jQuery(o.target).offset();jQuery(n).is(":visible")||jQuery(n).css({"background-color":"#000",padding:"3px 10px 3px 10px",top:i.top+jQuery(o.target).height()+"px",left:i.left+jQuery(o.target).width()+"px"}).animate({opacity:"0.85"},10).html(t.call(e)).show()}).mouseout(function(){jQuery(n).hide()})},t.exports=Sequence},{"./model":2,"./renderers":4,"./style":5,"biojs-events":6}],2:[function(e,t){function n(e,t){if(this.attributes={},this.defaults=t||{},e)for(var n in e)this.attributes[n]=e[n]}var o=e("biojs-events");o.mixin(n.prototype),n.prototype.has=function(e){return this.attributes.hasOwnProperty(e)},n.prototype.get=function(e){return this.attributes.hasOwnProperty(e)?this.attributes[e]:this.defaults[e]},n.prototype.set=function(e,t){var n,o,i,s=this,r=[];for(i in e)n=this.attributes[i],o=e[i],n!==o&&(r.push(["change:"+i,o,n]),this.attributes[i]=o);t&&t.silent||(r.forEach(function(e){s.trigger.apply(s,e)}),s.trigger("change"))},t.exports=n},{"biojs-events":6}],3:[function(e,t){var n=t.exports=function(){},o={A:"adenine",C:"cytosine",G:"guanine",T:"thymine"},i=function(e){return o[e.toUpperCase()]},s=function(){throw new Error("Not implemented")};n.optionalProperties=["addBaseClass","width","onMouseEnter"],n.requiredProperties=["onChangeSelection"];var r=function(e,t){var n="";return e.forEach(function(e){t>=e.start&&t<=e.end&&(n=e.kind)}),n};n.prototype={init:function(e){this.bases=[],n.optionalProperties.forEach(function(t){e[t]&&(this[t]=e[t])}.bind(this)),n.requiredProperties.forEach(function(t){if(!e[t])throw new Error("Missing required option: "+t);this[t]=e[t]}.bind(this))},getCanvas:function(){var e=document.createElement("pre");return e.className="sequence-canvas "+this.format.toLowerCase(),e},getBases:function(e){return e.split("").map(this.transformBase)},transformBase:function(e){return e.toUpperCase()},renderHeader:s,renderRow:s,renderFooter:s,getBaseClasses:function(e,t,n){var o=["seq-base"],s=i(e);return s&&this.addBaseClass&&o.push(s),o.push(n(t)),o},renderBase:function(e,t){var n=e.bases[t],o=e.start+t,i=this,s=document.createElement("span"),r=this.getBaseClasses(n,o,e.highlighter);return s.className=r.join(" "),s.appendChild(document.createTextNode(n)),s.addEventListener("mouseover",function(){i.onMouseEnter(o)}),i.onChangeSelection(function(e){o>=e.start&&o<=e.end?s.classList.add("selection"):s.classList.remove("selection")}),s},render:function(e,t,n){var o,i,s,a,c,l,h;if(e.length<1)return NO_CONTENT;for(a=this.getBases(e),i=this.getCanvas(),this.renderHeader(i,a,t),o=r.bind(null,n),s=1,h=0;h<a.length;h+=this.width,s++)c=a.slice(h,h+this.width),l={idx:s,bases:c,start:h+1,end:h+this.width,highlighter:o},this.renderRow(i,l);return this.renderFooter(i),i}}},{}],4:[function(e,t,n){var o=e("./renderer-base"),i=" ",s=function(){},r=n.FASTA=function(e){this.init(e)};r.prototype=new o,r.prototype.format="FASTA",r.prototype.renderHeader=function(e,t,n){var o=document.createTextNode(">"+n+" "+t.length+"bp");e.appendChild(o),e.appendChild(document.createElement("br"))},r.prototype.renderFooter=s,r.prototype.renderRow=function(e,t){var n,o;for(n=0;n<t.bases.length;n++)o=this.renderBase(t,n),e.appendChild(o);e.appendChild(document.createElement("br"))};var a=n.CODATA=function(e){this.init(e)};a.prototype=new o,a.prototype.format="CODATA",a.prototype.groupWidth=5,a.prototype.leftMarginSize=7,a.prototype.gutter=i+i,a.prototype.renderFooter=function(e){e.appendChild(document.createElement("br")),e.appendChild(document.createTextNode("///"))},a.prototype.renderHeader=function(e,t,n){var o,s,r,a=[];for(e.appendChild(document.createTextNode("ENTRY           ")),e.appendChild(document.createTextNode(n)),e.appendChild(document.createElement("br")),e.appendChild(document.createTextNode("SEQUENCE")),e.appendChild(document.createElement("br")),o=0;o<this.leftMarginSize;o++)a.push(i);a.push(this.gutter);var c=Math.min(t.length,this.width);for(o=this.groupWidth;c>=o;o+=this.groupWidth){for(s=String(o),r=2*this.groupWidth-(1+s.length);r>0;r--)a.push(i);a.push(s),a.push(i)}var l=document.createElement("span");l.className="sequence-header",l.appendChild(document.createTextNode(a.join(""))),e.appendChild(l),e.appendChild(document.createElement("br"))},a.prototype.renderInterBase=function(e,t,n){var o=document.createElement("span"),s=this.getBaseClasses(t,n,e.highlighter);return s.push("interbase"),o.className=s.join(" "),o.appendChild(document.createTextNode(i)),this.onChangeSelection(function(e){n>=e.start&&n<=e.end?o.classList.add("selection"):o.classList.remove("selection")}),o},a.prototype.renderRow=function(e,t){var n,o,s,r=String(t.start),a=[];for(n=this.leftMarginSize-r.length;n>0;n--)a.push(i);for(a.push(r,this.gutter),e.appendChild(document.createTextNode(a.join(""))),o=0;o<t.bases.length;o++)if(s=this.renderBase(t,o),e.appendChild(s),o+1<t.bases.length){var c=t.start+o+.5,l=this.renderInterBase(t,t.bases[o],c);e.appendChild(l)}e.appendChild(document.createElement("br"))};var c=n.PRIDE=function(e){this.init(e)};c.prototype=new o,c.prototype.format="PRIDE",c.prototype.groupWidth=10,c.prototype.marginSize=5,c.prototype.gutter=i+i,c.prototype.aisle=i,c.prototype.renderHeader=s,c.prototype.renderFooter=s,c.prototype.renderLabel=function(e){var t=String(e),n=[];for(needed=this.marginSize-t.length;needed>0;needed--)n.push("0");return n.push(t),document.createTextNode(n.join(""))},c.prototype.renderRow=function(e,t){var n,o;for(e.appendChild(this.renderLabel(t.start)),e.appendChild(document.createTextNode(this.gutter)),n=0;n<t.bases.length;n++)n>0&&n%this.groupWidth===0&&e.appendChild(document.createTextNode(this.aisle)),o=this.renderBase(t,n),e.appendChild(o);n===this.width&&(e.appendChild(document.createTextNode(this.gutter)),e.appendChild(this.renderLabel(t.end))),e.appendChild(document.createElement("br"))};var l=n.RAW=function(e){this.init(e)};l.prototype=new o,l.prototype.format="PRIDE",l.prototype.transformBase=function(e){return e},l.prototype.renderHeader=s,l.prototype.renderFooter=s,l.prototype.renderRow=function(e,t){var n,o;for(n=0;n<t.bases.length;n++)o=this.renderBase(t,n),e.appendChild(o);e.appendChild(document.createElement("br"))}},{"./renderer-base":3}],5:[function(e,t){t.exports=function(e,t){t.createStyleSheet?(stylesheet=t.createStyleSheet(),stylesheet.cssText=e):(head=t.getElementsByTagName("head")[0],stylesheet=t.createElement("style"),stylesheet.type="text/css",stylesheet.styleSheet?stylesheet.styleSheet.cssText=e:stylesheet.appendChild(t.createTextNode(e)),head.appendChild(stylesheet))}},{}],6:[function(e,t){var n=e("backbone-events-standalone");n.onAll=function(e,t){return this.on("all",e,t),this},n.oldMixin=n.mixin,n.mixin=function(e){n.oldMixin(e);for(var t=["onAll"],o=0;o<t.length;o++){var i=t[o];e[i]=this[i]}return e},t.exports=n},{"backbone-events-standalone":8}],7:[function(t,n,o){!function(){function t(){return{keys:Object.keys||function(e){if("object"!=typeof e&&"function"!=typeof e||null===e)throw new TypeError("keys() called on a non-object");var t,n=[];for(t in e)e.hasOwnProperty(t)&&(n[n.length]=t);return n},uniqueId:function(e){var t=++h+"";return e?e+t:t},has:function(e,t){return c.call(e,t)},each:function(e,t,n){if(null!=e)if(a&&e.forEach===a)e.forEach(t,n);else if(e.length===+e.length){for(var o=0,i=e.length;i>o;o++)if(t.call(n,e[o],o,e)===r)return}else for(var s in e)if(this.has(e,s)&&t.call(n,e[s],s,e)===r)return},once:function(e){var t,n=!1;return function(){return n?t:(n=!0,t=e.apply(this,arguments),e=null,t)}}}}var i,s=this,r={},a=Array.prototype.forEach,c=Object.prototype.hasOwnProperty,l=Array.prototype.slice,h=0,u=t();i={on:function(e,t,n){if(!d(this,"on",e,[t,n])||!t)return this;this._events||(this._events={});var o=this._events[e]||(this._events[e]=[]);return o.push({callback:t,context:n,ctx:n||this}),this},once:function(e,t,n){if(!d(this,"once",e,[t,n])||!t)return this;var o=this,i=u.once(function(){o.off(e,i),t.apply(this,arguments)});return i._callback=t,this.on(e,i,n)},off:function(e,t,n){var o,i,s,r,a,c,l,h;if(!this._events||!d(this,"off",e,[t,n]))return this;if(!e&&!t&&!n)return this._events={},this;for(r=e?[e]:u.keys(this._events),a=0,c=r.length;c>a;a++)if(e=r[a],s=this._events[e]){if(this._events[e]=o=[],t||n)for(l=0,h=s.length;h>l;l++)i=s[l],(t&&t!==i.callback&&t!==i.callback._callback||n&&n!==i.context)&&o.push(i);o.length||delete this._events[e]}return this},trigger:function(e){if(!this._events)return this;var t=l.call(arguments,1);if(!d(this,"trigger",e,t))return this;var n=this._events[e],o=this._events.all;return n&&f(n,t),o&&f(o,arguments),this},stopListening:function(e,t,n){var o=this._listeners;if(!o)return this;var i=!t&&!n;"object"==typeof t&&(n=this),e&&((o={})[e._listenerId]=e);for(var s in o)o[s].off(t,n,this),i&&delete this._listeners[s];return this}};var p=/\s+/,d=function(e,t,n,o){if(!n)return!0;if("object"==typeof n){for(var i in n)e[t].apply(e,[i,n[i]].concat(o));return!1}if(p.test(n)){for(var s=n.split(p),r=0,a=s.length;a>r;r++)e[t].apply(e,[s[r]].concat(o));return!1}return!0},f=function(e,t){var n,o=-1,i=e.length,s=t[0],r=t[1],a=t[2];switch(t.length){case 0:for(;++o<i;)(n=e[o]).callback.call(n.ctx);return;case 1:for(;++o<i;)(n=e[o]).callback.call(n.ctx,s);return;case 2:for(;++o<i;)(n=e[o]).callback.call(n.ctx,s,r);return;case 3:for(;++o<i;)(n=e[o]).callback.call(n.ctx,s,r,a);return;default:for(;++o<i;)(n=e[o]).callback.apply(n.ctx,t)}},g={listenTo:"on",listenToOnce:"once"};u.each(g,function(e,t){i[t]=function(t,n,o){var i=this._listeners||(this._listeners={}),s=t._listenerId||(t._listenerId=u.uniqueId("l"));return i[s]=t,"object"==typeof n&&(o=this),t[e](n,o,this),this}}),i.bind=i.on,i.unbind=i.off,i.mixin=function(e){var t=["on","once","off","trigger","stopListening","listenTo","listenToOnce","bind","unbind"];return u.each(t,function(t){e[t]=this[t]},this),e},"function"==typeof e?e(function(){return i}):"undefined"!=typeof o?("undefined"!=typeof n&&n.exports&&(o=n.exports=i),o.BackboneEvents=i):s.BackboneEvents=i}(this)},{}],8:[function(e,t){t.exports=e("./backbone-events-standalone")},{"./backbone-events-standalone":7}],"biojs-vis-sequence":[function(e,t){t.exports=e("./lib/index")},{"./lib/index":1}]},{},["biojs-vis-sequence"])("biojs-vis-sequence")});