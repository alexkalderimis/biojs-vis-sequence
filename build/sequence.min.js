!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;"undefined"!=typeof window?t=window:"undefined"!=typeof global?t=global:"undefined"!=typeof self&&(t=self),t.oo=e()}}(function(){var e;return function t(e,n,o){function i(s,a){if(!n[s]){if(!e[s]){var c="function"==typeof require&&require;if(!a&&c)return c(s,!0);if(r)return r(s,!0);var h=new Error("Cannot find module '"+s+"'");throw h.code="MODULE_NOT_FOUND",h}var l=n[s]={exports:{}};e[s][0].call(l.exports,function(t){var n=e[s][1][t];return i(n?n:t)},l,l.exports,t,e,n,o)}return n[s].exports}for(var r="function"==typeof require&&require,s=0;s<o.length;s++)i(o[s]);return i}({1:[function(e,t){var n="selection-change",o="selection-changed",i="annotation-clicked",r=e("./renderers"),s=e("./model"),a=e("biojs-events"),c={format:"FASTA",selection:{start:0,end:0},numCols:35,highlights:[],annotations:[],sequenceUrl:"http://www.ebi.ac.uk/das-srv/uniprot/das/uniprot/sequence",formatSelectorVisible:!0,loadStyle:!0};Sequence=function(e){this._container=jQuery(e.target),0===this._container.length&&(this._container=jQuery("#"+e.target)),this.options=new s(e,c),this._initialize()},a.mixin(Sequence.prototype),Sequence.prototype.eventTypes=[o,n,i],Sequence.prototype.getId=function(){return this.opt.id};var h={position:"absolute","z-index":"999999",color:"#fff","font-size":"12px",width:"auto",display:"none"};Sequence.prototype._initialize=function(){var e=this;this.options.get("loadStyle")&&this._appendStyle(),["width","height"].forEach(function(t){var n=e.options.get(t);n>0&&e._container[t](n)}),this.options.get("allowSelection")||this._container.addClass("no-user-selection"),this.options.on("change:allowSelection",function(t){t?e._container.removeClass("no-user-selection"):e._container.addClass("no-user-selection")}),this._buildFormatSelector(),this._contentDiv=jQuery("<div>").addClass("sequence-content").appendTo(this._container),this._tooltip=jQuery("<div>").css(h).addClass("tooltip").appendTo("body").hide(),this.options.on("change:format",function(t){var n=r[t];if(!n)throw new Error("Don't know how to render "+t);e._Renderer=n}),this.options.trigger("change:format",this.options.get("format"));var t=function(){e._redraw()};this.options.on("change:highlights",t),this.options.on("change:format",t),this.options.on("change:numCols",t),this.options.on("change:sequence",t),this.options.on("change:id",t),this.options.on("change:sequence",function(){e.options.set({highlights:[],annotations:[]},{silent:!0}),e.setSelection(0,0)}),this.options.on("change:selection",function(t){e.trigger(o,t)}),this._contentDiv.on("mousedown",function(){e.startSelecting()}),this._contentDiv.on("mouseup",function(){e.stopSelecting()}),this._contentDiv.on("mouseleave",function(){e.stopSelecting()}),this.options.has("sequence")?this.trigger("set:sequence"):this.options.has("id")?this._requestSequence(this.getId()):this.clearSequence("No sequence available","../biojs/css/images/warning_icon.png")};var l="../biojs/css/images/warning_icon.png";Sequence.prototype._requestSequence=function(e){var t=this;jQuery.ajax({url:this.options.get("sequenceUrl"),dataType:"xml",data:{segment:e},success:function(){try{var e=jQuery(xml).find("SEQUENCE:first");t.setSequence(e.text(),e.attr("id"),e.attr("label"))}catch(n){console.log("Error decoding response data: "+n.message),t.clearSequence("No sequence available",l)}},error:function(e,n){console.log("Error decoding response data: "+n),t.clearSequence("Error requesting the sequence to the server "+this.url,l)}})},Sequence.prototype.setSequence=function(e,t){1===arguments.length?this._requestSequence(arguments[0]):this.options.set({sequence:e,id:t})},Sequence.prototype.clearSequence=function(e,t){var n;this.setSequence("",""),e?(n=jQuery("<div>").text(e).addClass("message"),t&&n.css({background:'transparent url("'+t+'") no-repeat center left',"padding-left":"20px"}),this._contentDiv.html(n)):this._contentDiv.empty()},Sequence.prototype.setSelection=function(e,t){if(e>t){var n=t;t=e,e=n}this.options.set({selection:{start:e,end:t}})};var u=[".seq-base.adenine {background: green; color: white;}",".seq-base.cytosine {background: red; color: white;}",".seq-base.guanine {background: blue; color: white;}",".seq-base.thymine {background: orange; color: white;}",".seq-base.info, .interbase.info {background: #4090f7; color: white;}",'.sequence-content {font-family: "Andale mone", courier, monospace; font-size: 12px; text-align: left;}','.sequence-controls {font-family: "Helvetica Neue", Arial, "sans serif"; font-size: 14px}',".no-user-selection {-moz-user-select: none; -webkit-user-select: none; user-select: none;}",".seq-base.selection, .interbase.selection {background: yellow; color: black;}"];Sequence.prototype._appendStyle=function(){var e,t,n;e=u.join("\n"),document.createStyleSheet?(n=document.createStyleSheet(),n.cssText=e):(t=document.getElementsByTagName("head")[0],n=document.createElement("style"),n.type="text/css",n.styleSheet?n.styleSheet.cssText=e:n.appendChild(document.createTextNode(e)),t.appendChild(n))},Sequence.prototype.setFormat=function(e){if(!e)throw new Error("argument is required: format");this.options.set({format:String(e).toUpperCase()})},Sequence.prototype._buildFormatSelector=function(){var e=this;this._headerDiv=jQuery("<div>").addClass("sequence-controls").append("<label>Format:</label>").appendTo(this._container),this._formatSelector=jQuery('<select> <option value="FASTA">FASTA</option><option value="CODATA">CODATA</option><option value="PRIDE">PRIDE</option><option value="RAW">RAW</option></select>').appendTo(e._headerDiv),this._formatSelector.change(function(){e.setFormat(jQuery(this).val())}),this.options.on("change:format",function(t){e._formatSelector.val(t)}),this._formatSelector.val(e.options.get("format")),e._headerDiv.append("<label>Columns</label>"),this._columnWidthSelector=jQuery('<select><option value="10">10</option><option value="35">35</option><option value="70">70</option><option value="100">100</option></select>').appendTo(e._headerDiv),this._columnWidthSelector.val(String(this.options.get("numCols"))),this._columnWidthSelector.change(function(){e.options.set({numCols:parseInt(jQuery(this).val(),10)})}),this.options.on("change:numCols",function(t){e._columnWidthSelector.val(String(t))}),this.options.on("change:formatSelectorVisible",function(){e._headerDiv.toggle(e.options.get("formatSelectorVisible"))}),e._headerDiv.toggle(e.options.get("formatSelectorVisible"))},Sequence.prototype.highlight=function(e,t,n,o){return this.addHighlight({start:e,end:t,kind:n,id:o})},Sequence.prototype._highlightsCount=0,Sequence.prototype.addHighlight=function(e){var t,n,o,i=this.options.get("highlights");return!e||e.start>e.end?null:(n=e.kind||"info",t="string"==typeof e.id?e.id:String(this._highlightsCount++),o={start:e.start,end:e.end,kind:n,id:t},i=i.concat([o]),this.options.set({highlights:i}),o.id)},Sequence.prototype.unHighlight=function(e){this.removeHighlight(e)},Sequence.prototype.removeHighlight=function(e){this.options.set({highlights:this.options.get("highlights").filter(function(t){return t.id!==e})})},Sequence.prototype.unHighlightAll=function(){this.removeAllHighlights()},Sequence.prototype.removeAllHighlights=function(){this.options.set({highlights:[]})},Sequence.prototype.setNumCols=function(e){this.options.set({numCols:e})},Sequence.prototype.formatSelectorVisible=function(e){return 0===arguments.length?this.options.get("formatSelectorVisible"):void this.options.set({formatSelectorVisible:e})},Sequence.prototype.showFormatSelector=function(){this.formatSelectorVisible(!0)},Sequence.prototype.hideFormatSelector=function(){this.formatSelectorVisible(!1)},Sequence.prototype.hide=function(){this._headerDiv.hide(),this._contentDiv.hide()},Sequence.prototype.show=function(){this._headerDiv.show(),this._contentDiv.show()},Sequence.prototype._isSelecting=!1,Sequence.prototype._lastEntered=-1,Sequence.prototype.startSelecting=function(){this._isSelecting=!0,this.setSelection(this._lastEntered,this._lastEntered)},Sequence.prototype.stopSelecting=function(){this._isSelecting=!1,this._lastEntered=-1},Sequence.prototype._recordEntry=function(e){if(this._lastEntered=e,this._isSelecting){var t=this.options.get("selection");this.setSelection(t.start,e)}},Sequence.prototype._redraw=function(){var e=new this._Renderer({width:this.options.get("numCols"),sequence:this.options.get("sequence"),id:this.options.get("id"),highlights:this.getHighlights(),onMouseEnter:this._recordEntry.bind(this),onChangeSelection:this.options.on.bind(this.options,"change:selection")});this._contentDiv.html(e.render())},Sequence.prototype.getHighlights=function(){var e=this.options.get("highlights").slice(),t=this.options.get("selection");return t&&e.push({start:t.start,end:t.end,kind:"selection",id:"__selection__"}),e},Sequence.prototype._addToolTip=function(e,t){var n="#sequenceTip"+this.getId();jQuery(e).mouseover(function(o){var i=jQuery(o.target).offset();jQuery(n).is(":visible")||jQuery(n).css({"background-color":"#000",padding:"3px 10px 3px 10px",top:i.top+jQuery(o.target).height()+"px",left:i.left+jQuery(o.target).width()+"px"}).animate({opacity:"0.85"},10).html(t.call(e)).show()}).mouseout(function(){jQuery(n).hide()})},t.exports=Sequence},{"./model":2,"./renderers":3,"biojs-events":4}],2:[function(e,t){function n(e,t){if(this.attributes={},this.defaults=t||{},e)for(var n in e)this.attributes[n]=e[n]}var o=e("biojs-events");o.mixin(n.prototype),n.prototype.has=function(e){return this.attributes.hasOwnProperty(e)},n.prototype.get=function(e){return this.attributes.hasOwnProperty(e)?this.attributes[e]:this.defaults[e]},n.prototype.set=function(e,t){var n,o,i,r=this,s=[];for(i in e)n=this.attributes[i],o=e[i],n!==o&&(s.push(["change:"+i,o,n]),this.attributes[i]=o);t&&t.silent||(s.forEach(function(e){r.trigger.apply(r,e)}),r.trigger("change"))},t.exports=n},{"biojs-events":4}],3:[function(e,t,n){function o(){}var i=" ",r=function(){throw new Error("Not implemented")},s=function(){};classNamesFor={A:"adenine",C:"cytosine",G:"guanine",T:"thymine"};var a=function(e){return classNamesFor[e.toUpperCase()]};o.prototype={init:function(e){this.bases=[],o.optionalProperties.forEach(function(t){e[t]&&(this[t]=e[t])}.bind(this)),o.requiredProperties.forEach(function(t){if(!e[t])throw new Error("Missing required option: "+t);this[t]=e[t]}.bind(this)),this.bases=this.getBases()},getCanvas:function(){var e=document.createElement("pre");return e.className="sequence-canvas "+this.format.toLowerCase(),e},getBases:function(){return this.sequence.split("").map(this.transformBase)},transformBase:function(e){return e.toUpperCase()},renderHeader:r,renderRow:r,renderFooter:r,getHighlightClass:function(e){var t="";return this.highlights.forEach(function(n){e>=n.start&&e<=n.end&&(t=n.kind)}),t},renderBase:function(e,t){var n=this,o=document.createElement("span"),i=["seq-base",a(e)];return i.push(this.getHighlightClass(t)),o.className=i.join(" "),o.appendChild(document.createTextNode(e)),o.addEventListener("mouseover",function(){n.onMouseEnter(t)}),n.onChangeSelection(function(e){t>=e.start&&t<=e.end?o.classList.add("selection"):o.classList.remove("selection")}),o},render:function(){var e,t,n,o;if(this.sequence.length<1)return NO_CONTENT;this.bases=this.getBases(this.sequence);var i=this.getCanvas();for(this.renderHeader(i),e=1,o=0;o<this.bases.length;o+=this.width,e++)t=this.bases.slice(o,o+this.width),n={idx:e,bases:t,start:o+1,end:o+this.width},this.renderRow(i,n);return this.renderFooter(i),i}},o.optionalProperties=["width","onMouseEnter"],o.requiredProperties=["sequence","id","highlights","onChangeSelection"];var c=n.FASTA=function(e){this.init(e)};c.prototype=new o,c.prototype.format="FASTA",c.prototype.renderHeader=function(e){var t=document.createTextNode(">"+this.id+" "+this.bases.length+"bp");e.appendChild(t),e.appendChild(document.createElement("br"))},c.prototype.renderFooter=s,c.prototype.renderRow=function(e,t){var n,o;for(n=0;n<t.bases.length;n++)o=this.renderBase(t.bases[n],n+t.start),e.appendChild(o);e.appendChild(document.createElement("br"))};var h=n.CODATA=function(e){this.init(e)};h.prototype=new o,h.prototype.format="CODATA",h.prototype.groupWidth=5,h.prototype.leftMarginSize=7,h.prototype.gutter=i+i,h.prototype.renderFooter=function(e){e.appendChild(document.createElement("br")),e.appendChild(document.createTextNode("///"))},h.prototype.renderHeader=function(e){var t,n,o,r=[];for(e.appendChild(document.createTextNode("ENTRY           ")),e.appendChild(document.createTextNode(this.id)),e.appendChild(document.createElement("br")),e.appendChild(document.createTextNode("SEQUENCE")),e.appendChild(document.createElement("br")),t=0;t<this.leftMarginSize;t++)r.push(i);r.push(this.gutter);var s=Math.min(this.bases.length,this.width);for(t=this.groupWidth;s>=t;t+=this.groupWidth){for(n=String(t),o=2*this.groupWidth-(1+n.length);o>0;o--)r.push(i);r.push(n),r.push(i)}var a=document.createElement("span");a.className="sequence-header",a.appendChild(document.createTextNode(r.join(""))),e.appendChild(a),e.appendChild(document.createElement("br"))},h.prototype.renderInterBase=function(e,t){var n=document.createElement("span");return n.className="interbase seq-base "+a(e)+" "+this.getHighlightClass(t),n.appendChild(document.createTextNode(i)),this.onChangeSelection(function(e){t>=e.start&&t<=e.end?n.classList.add("selection"):n.classList.remove("selection")}),n},h.prototype.renderRow=function(e,t){var n,o,r,s=String(t.start),a=[];for(n=this.leftMarginSize-s.length;n>0;n--)a.push(i);for(a.push(s,this.gutter),e.appendChild(document.createTextNode(a.join(""))),o=0;o<t.bases.length;o++)if(r=this.renderBase(t.bases[o],o+t.start),e.appendChild(r),o+1<t.bases.length){var c=t.start+o+.5,h=this.renderInterBase(t.bases[o],c);e.appendChild(h)}e.appendChild(document.createElement("br"))};var l=n.PRIDE=function(e){this.init(e)};l.prototype=new o,l.prototype.format="PRIDE",l.prototype.groupWidth=10,l.prototype.marginSize=5,l.prototype.gutter=i+i,l.prototype.aisle=i,l.prototype.renderHeader=s,l.prototype.renderFooter=s,l.prototype.renderLabel=function(e){var t=String(e),n=[];for(needed=this.marginSize-t.length;needed>0;needed--)n.push("0");return n.push(t),document.createTextNode(n.join(""))},l.prototype.renderRow=function(e,t){var n,o;for(e.appendChild(this.renderLabel(t.start)),e.appendChild(document.createTextNode(this.gutter)),n=0;n<t.bases.length;n++)n>0&&n%this.groupWidth===0&&e.appendChild(document.createTextNode(this.aisle)),o=this.renderBase(t.bases[n],n+t.start),e.appendChild(o);n===this.width&&(e.appendChild(document.createTextNode(this.gutter)),e.appendChild(this.renderLabel(t.end))),e.appendChild(document.createElement("br"))};var u=n.RAW=function(e){this.init(e)};u.prototype=new o,u.prototype.format="PRIDE",u.prototype.transformBase=function(e){return e},u.prototype.renderHeader=s,u.prototype.renderFooter=s,u.prototype.renderRow=function(e,t){var n,o;for(n=0;n<t.bases.length;n++)o=this.renderBase(t.bases[n],n+t.start),e.appendChild(o);e.appendChild(document.createElement("br"))}},{}],4:[function(e,t){var n=e("backbone-events-standalone");n.onAll=function(e,t){return this.on("all",e,t),this},n.oldMixin=n.mixin,n.mixin=function(e){n.oldMixin(e);for(var t=["onAll"],o=0;o<t.length;o++){var i=t[o];e[i]=this[i]}return e},t.exports=n},{"backbone-events-standalone":6}],5:[function(t,n,o){!function(){function t(){return{keys:Object.keys||function(e){if("object"!=typeof e&&"function"!=typeof e||null===e)throw new TypeError("keys() called on a non-object");var t,n=[];for(t in e)e.hasOwnProperty(t)&&(n[n.length]=t);return n},uniqueId:function(e){var t=++l+"";return e?e+t:t},has:function(e,t){return c.call(e,t)},each:function(e,t,n){if(null!=e)if(a&&e.forEach===a)e.forEach(t,n);else if(e.length===+e.length){for(var o=0,i=e.length;i>o;o++)if(t.call(n,e[o],o,e)===s)return}else for(var r in e)if(this.has(e,r)&&t.call(n,e[r],r,e)===s)return},once:function(e){var t,n=!1;return function(){return n?t:(n=!0,t=e.apply(this,arguments),e=null,t)}}}}var i,r=this,s={},a=Array.prototype.forEach,c=Object.prototype.hasOwnProperty,h=Array.prototype.slice,l=0,u=t();i={on:function(e,t,n){if(!d(this,"on",e,[t,n])||!t)return this;this._events||(this._events={});var o=this._events[e]||(this._events[e]=[]);return o.push({callback:t,context:n,ctx:n||this}),this},once:function(e,t,n){if(!d(this,"once",e,[t,n])||!t)return this;var o=this,i=u.once(function(){o.off(e,i),t.apply(this,arguments)});return i._callback=t,this.on(e,i,n)},off:function(e,t,n){var o,i,r,s,a,c,h,l;if(!this._events||!d(this,"off",e,[t,n]))return this;if(!e&&!t&&!n)return this._events={},this;for(s=e?[e]:u.keys(this._events),a=0,c=s.length;c>a;a++)if(e=s[a],r=this._events[e]){if(this._events[e]=o=[],t||n)for(h=0,l=r.length;l>h;h++)i=r[h],(t&&t!==i.callback&&t!==i.callback._callback||n&&n!==i.context)&&o.push(i);o.length||delete this._events[e]}return this},trigger:function(e){if(!this._events)return this;var t=h.call(arguments,1);if(!d(this,"trigger",e,t))return this;var n=this._events[e],o=this._events.all;return n&&f(n,t),o&&f(o,arguments),this},stopListening:function(e,t,n){var o=this._listeners;if(!o)return this;var i=!t&&!n;"object"==typeof t&&(n=this),e&&((o={})[e._listenerId]=e);for(var r in o)o[r].off(t,n,this),i&&delete this._listeners[r];return this}};var p=/\s+/,d=function(e,t,n,o){if(!n)return!0;if("object"==typeof n){for(var i in n)e[t].apply(e,[i,n[i]].concat(o));return!1}if(p.test(n)){for(var r=n.split(p),s=0,a=r.length;a>s;s++)e[t].apply(e,[r[s]].concat(o));return!1}return!0},f=function(e,t){var n,o=-1,i=e.length,r=t[0],s=t[1],a=t[2];switch(t.length){case 0:for(;++o<i;)(n=e[o]).callback.call(n.ctx);return;case 1:for(;++o<i;)(n=e[o]).callback.call(n.ctx,r);return;case 2:for(;++o<i;)(n=e[o]).callback.call(n.ctx,r,s);return;case 3:for(;++o<i;)(n=e[o]).callback.call(n.ctx,r,s,a);return;default:for(;++o<i;)(n=e[o]).callback.apply(n.ctx,t)}},g={listenTo:"on",listenToOnce:"once"};u.each(g,function(e,t){i[t]=function(t,n,o){var i=this._listeners||(this._listeners={}),r=t._listenerId||(t._listenerId=u.uniqueId("l"));return i[r]=t,"object"==typeof n&&(o=this),t[e](n,o,this),this}}),i.bind=i.on,i.unbind=i.off,i.mixin=function(e){var t=["on","once","off","trigger","stopListening","listenTo","listenToOnce","bind","unbind"];return u.each(t,function(t){e[t]=this[t]},this),e},"function"==typeof e?e(function(){return i}):"undefined"!=typeof o?("undefined"!=typeof n&&n.exports&&(o=n.exports=i),o.BackboneEvents=i):r.BackboneEvents=i}(this)},{}],6:[function(e,t){t.exports=e("./backbone-events-standalone")},{"./backbone-events-standalone":5}],"biojs-vis-sequence":[function(e,t){t.exports=e("./lib/index")},{"./lib/index":1}]},{},["biojs-vis-sequence"])("biojs-vis-sequence")});